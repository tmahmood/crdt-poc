<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/vite.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href='src/base.css' rel='stylesheet' type='text/css'>
        <title>Todo</title>
    </head>
    <body>
    <div>
        <strong>Yay, you are online!</strong>
        Now go offline and <a href="#" id="refresh">refresh</a>!
        Registered ServiceWorker:	<span id="register">Did not register</span>
        Active Controller:	<span id="controller">Did not activate</span>
        ServiceWorker logs:
        <div id="log">Here be logs: <br></div>
        <button id="clearAndReRegister">View Complete Demo Again</button>
    </div>
    <div id="app"></div>
         <script type="module" src="/src/main.ts"></script>
    </body>
    <script type="module" src="sw.ts"></script>
    <script>
        function registerServiceWorker() {
            if (navigator.serviceWorker.controller) {
                // A ServiceWorker controls the site on load and therefor can handle offline
                // fallbacks.
                debug(navigator.serviceWorker.controller.scriptURL + ' (onload)', 'controller');
                debug('An active service worker controller was found, ' + 'no need to register');
            } else {
                console.log("Registering service worker")
                // Register the ServiceWorker
                navigator.serviceWorker.register('sw.ts')
                    .then((reg) => {
                        debug(reg.scope, 'register');
                        debug('Service worker change, registered the service worker');
                        console.log("Registered new service worker")
                    }).catch((e) => {
                    console.log(e);
                });
            }

            document.querySelector('#refresh').search = Date.now();
            function debug(message, element, append) {
                const target = document.querySelector('#' + (element || 'log'));
                if (target) {
                    target.textContent = message + ((append) ? ('/n' + target.textContent) : '');
                }
            }

            // Allow for "replaying" this example
            document.getElementById('clearAndReRegister').addEventListener('click',
                function () {
                    navigator.serviceWorker.getRegistration().then(function (registration) {
                        if (registration) {
                            registration.unregister().then(() => {});
                            window.location.reload();
                        }
                    });
                }
            );
        }
        registerServiceWorker();
</script>

</html>
